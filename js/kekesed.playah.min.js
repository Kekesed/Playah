/* 
	Playah Javascript Plugin for MetroUI
	Requires jQuery and MetroUI CSS Bootstrap.
	
	Copyright (c)2015 Kekesed. All rights reserved.
	https://app.kekesed.gq/run/Playah/
*/
$.widget("kekesed.playah",{options:{theme:"blue",autoplay:!1,random:!1,loop:!0,android_mode:!0,playlist:[],header:{height:"150px",color:"darkBlue"},callback:{onNext:function(){},onPrev:function(){},onState:function(){},onError:function(){},onLoad:function(){}}},vars:{btn:{ply:null,rew:null,fwd:null},icn:{ply:null,pau:null},songId:0,state:"pause",kontrol:{img:null,judul:null,pbar:null},statis:{player:null,temp:null}},_create:function(){var t=this.element,s=$("<section/>",{"class":"playah-picture bg-"+this.options.header.color}).css({overflow:"hidden",height:this.options.header.height}),a=$("<section/>",{"class":"playah-progressbar progress-bar no-margin bg-dark"}).progressbar({value:100,color:"bg-"+this.options.theme,animate:!1}),i=$("<section/>",{"class":"playah-konten bg-white padding15"}),n=$("<button/>",{"class":"large bg-"+this.options.theme+" fg-white"}),o=$("<button/>",{"class":"fg-"+this.options.theme}),e=$("<button/>",{"class":"fg-"+this.options.theme}),l=$("<i/>",{"class":"icon-play-2"}).appendTo(n),r=($("<i/>",{"class":"icon-previous"}).appendTo(o),$("<i/>",{"class":"icon-next"}).appendTo(e),$("<i/>",{"class":"icon-pause-2"})),p=$("<div/>",{"class":"playah-judulan text-center"}),h=$("<div/>",{"class":"playah-control text-center margin10"});o.appendTo(h),n.appendTo(h),e.appendTo(h),p.appendTo(i),h.appendTo(i),s.appendTo(t),a.appendTo(t),i.appendTo(t),this.vars.btn.ply=n,this.vars.btn.rew=o,this.vars.btn.fwd=e,this.vars.icn.ply=l,this.vars.icn.pau=r,this.vars.kontrol.img=s,this.vars.kontrol.judul=p,this.vars.kontrol.pbar=a,0==this.options.playlist.length?(this._ganti_judul({title:"Playlist unloaded",artist:"Playah",album:"Ganteng dan Tamvan"}),this._navRefresh()):this.options.playlist.length>0&&this._navRefresh(),this.options.random&&(this.options.playlist=this._fliptable(this.options.playlist)),this._play(),this.options.autoplay&&this._triggerplay();var d=this;n.click(function(){d._triggerplay()}),o.click(function(){d.pref()}),e.click(function(){d.next()}),this.options.callback.onLoad()},_audioRefresh:function(){var t=this.vars.statis.player;t.prop("currentTime","0"),"pause"==this.vars.state?($(this.vars.btn.ply).html(""),this.vars.icn.ply.appendTo(this.vars.btn.ply),t.trigger("pause")):($(this.vars.btn.ply).html(""),this.vars.icn.pau.appendTo(this.vars.btn.ply),t.trigger("play"))},next:function(){var t=this;t._plop(),t._play(),t._audioRefresh(),this.options.callback.onNext(this.options.playlist[this.vars.songId])},pref:function(){var t=this;t.options.android_mode&&t.vars.statis.player.prop("currentTime")>=5?t.vars.statis.player.prop("currentTime",0):(t._glop(),t._play()),t._audioRefresh(),this.options.callback.onPrev(this.options.playlist[this.vars.songId])},_navRefresh:function(){this.options.playlist.length<=1?(this.vars.btn.rew.attr("disabled","disabled"),this.vars.btn.fwd.attr("disabled","disabled"),0==this.options.playlist.length?this.vars.btn.ply.attr("disabled","disabled"):this.vars.btn.ply.removeAttr("disabled","disabled")):(this.vars.btn.rew.removeAttr("disabled"),this.vars.btn.fwd.removeAttr("disabled"),this.vars.btn.ply.removeAttr("disabled"))},_plop:function(){this.vars.songId>=this.options.playlist.length-1?this.vars.songId=this.options.loop?0:this.options.playlist.length-1:this.vars.songId+=1},_glop:function(){0==this.vars.songId?this.vars.songId=this.options.loop?this.options.playlist.length-1:0:this.vars.songId-=1},_play:function(){"undefined"!=typeof this.vars.statis.player&&null!=this.vars.statis.player&&this.vars.statis.temp.remove();var t=this.vars.songId;this._ganti_judul(this.options.playlist[t].meta);var s=this._audiofuck(this.options.playlist[t].src);"undefined"!=typeof this.options.playlist[t].meta.image&&null!=this.options.playlist[t].meta.image&&this._imgchew(this.options.playlist[t].meta.image);var a=$("<div/>",{"class":"playah-temp"}).appendTo(this.element).css({display:"none"});this.vars.statis.temp=a,s.appendTo(a),s.trigger("load"),this.vars.kontrol.pbar.progressbar("value",0);var i=this.vars.kontrol.pbar,n=this;s.bind("timeupdate",function(){var t=$(this).prop("duration"),s=$(this).prop("currentTime");i.progressbar("value",s/t*100)}),s.bind("ended",function(){n.next()}),this.vars.kontrol.pbar.click(function(t){var a=t.pageX-$(this).offset().left,i=a/$(this).innerWidth();s.prop("currentTime",s.prop("duration")*i)}),this.vars.statis.player=s},_triggerplay:function(){var t=this.vars.statis.player;"pause"==this.vars.state?($(this.vars.btn.ply).html(""),this.vars.icn.pau.appendTo(this.vars.btn.ply),t.trigger("play"),this.vars.state="play"):($(this.vars.btn.ply).html(""),this.vars.icn.ply.appendTo(this.vars.btn.ply),t.trigger("pause"),this.vars.state="pause"),this.options.callback.onState(this.vars.state,this.options.playlist[this.vars.songId])},_ganti_judul:function(t){if(this.vars.kontrol.judul.html(""),"undefined"!=typeof t.title&&null!=t.title)var s=$("<strong/>",{"class":"playah-judul"}).text(t.title);else var s=$("<strong/>",{"class":"playah-judul"}).text("Untitled Song");if(s.appendTo(this.vars.kontrol.judul),this.vars.kontrol.judul.append("<br>"),"undefined"!=typeof t.artist&&null!=t.artist){var a=$("<small/>",{"class":"playah-artist text-bold fg-"+this.options.theme}).text(t.artist);a.appendTo(this.vars.kontrol.judul),this.vars.kontrol.judul.append(" ")}if("undefined"!=typeof t.album&&null!=t.album){var i=$("<small/>",{"class":"playah-album"}).text(t.album);i.appendTo(this.vars.kontrol.judul)}},_audiofuck:function(t){var s=$("<audio/>",{preload:"none"}),a=$("<source/>",{src:t.mp3,type:"audio/mpeg"});if(a.appendTo(s),"undefined"!=typeof t.ogg&&null!==t.ogg){var i=$("<source/>",{src:t.ogg,type:"audio/ogg"});i.appendTo(s)}return s},_imgchew:function(t){var s=$("<img/>",{src:t});this.vars.kontrol.img.html(""),s.appendTo(this.vars.kontrol.img)},_fliptable:function(t){for(var s=t.length-1;s>0;s--){var a=Math.floor(Math.random()*(s+1)),i=t[s];t[s]=t[a],t[a]=i}return t}}),$.fn.extend({ksd_info:{Playah:function(){return"1.3"}}});